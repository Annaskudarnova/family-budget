<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/style.css">
   <!-- üì± –î–æ–±–∞–≤–ª—è–µ–º PWA-–º–∞–Ω–∏—Ñ–µ—Å—Ç -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">

  <!-- –î–ª—è iPhone (–∏–∫–æ–Ω–∫–∏ –∏ —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞) -->
  <link rel="apple-touch-icon" href="images/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>–†–∞—Å—Ö–æ–¥—ã</title>
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="header__content">
        <a class="header__logo-link" href="advice.html">
          <img class="header__logo" src="images/logo.png" height="36" width="170" alt="–õ–æ–≥–æ—Ç–∏–ø –°–µ–º–µ–π–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞">
        </a>
        <button class="header__menu">
          <span class="header__menu-line"></span>
        </button>
      </div>
    </div>
  </header>
  <main>
    <div class="breadcrumbs">
      <div class="container">
        <ul class="breadcrumbs__list">
          <li class="breadcrumbs__item">
            <a class="breadcrumbs__link" href="advice.html">–ì–ª–∞–≤–Ω–∞—è</a>
          </li>
          <li class="breadcrumbs__item">
            <span class="breadcrumbs__link">–†–∞—Å—Ö–æ–¥—ã</span>
          </li>
        </ul>
      </div>
    </div>
    
      <h1 class="page-content__title">–†–∞—Å—Ö–æ–¥—ã</h1>
      <div class="cont">
        <div class="label-text">
      <form id="expenseForm">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:
          <select name="category" required>
            <option value="–ü—Ä–æ–¥—É–∫—Ç—ã">–ü—Ä–æ–¥—É–∫—Ç—ã</option>
            <option value="–ö–≤–∞—Ä—Ç.–ø–ª–∞—Ç–∞">–ö–≤–∞—Ä—Ç.–ø–ª–∞—Ç–∞</option>
            <option value="–ò–Ω—Ç–µ—Ä–Ω–µ—Ç">–ò–Ω—Ç–µ—Ä–Ω–µ—Ç</option>
            <option value="–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å">–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å</option>
            <option value="–ó–∞–∫–∞–∑ –µ–¥—ã">–ó–∞–∫–∞–∑ –µ–¥—ã</option>
            <option value="–ü–æ–¥–∞—Ä–∫–∏">–ü–æ–¥–∞—Ä–∫–∏</option>
            <option value="–ö–∞—Ñ–µ/—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">–ö–∞—Ñ–µ/—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
            <option value="–°–µ–∫—Ü–∏–∏">–°–µ–∫—Ü–∏–∏</option>
            <option value="–£—á—ë–±–∞ –¥–µ—Ç–µ–π">–£—á—ë–±–∞ –¥–µ—Ç–µ–π</option>
            <option value="–†–∞—Å—Å—Ä–æ—á–∫–∏/–∏–ø–æ—Ç–µ–∫–∞">–†–∞—Å—Å—Ä–æ—á–∫–∏/–∏–ø–æ—Ç–µ–∫–∞</option>
            <option value="–ë–µ–Ω–∑–∏–Ω/–º–∞—à–∏–Ω–∞">–ë–µ–Ω–∑–∏–Ω/–º–∞—à–∏–Ω–∞</option>
            <option value="–ú–µ–¥–∏—Ü–∏–Ω–∞/–ª–µ–∫–∞—Ä—Å—Ç–≤–∞">–ú–µ–¥–∏—Ü–∏–Ω–∞/–ª–µ–∫–∞—Ä—Å—Ç–≤–∞</option>
            <option value="–ü—Ä–æ–µ–∑–¥">–ü—Ä–æ–µ–∑–¥</option>
            <option value="–û–¥–µ–∂–¥–∞/–æ–±—É–≤—å">–û–¥–µ–∂–¥–∞/–æ–±—É–≤—å</option>
            <option value="–ö—Ä–∞—Å–æ—Ç–∞">–ö—Ä–∞—Å–æ—Ç–∞</option>
            <option value="–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è/–≥–∏–≥–∏–µ–Ω–∞">–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è/–≥–∏–≥–∏–µ–Ω–∞</option>
            <option value="–î–ª—è –¥–æ–º–∞">–î–ª—è –¥–æ–º–∞</option>
            <option value="–°–∏–≥–∞—Ä–µ—Ç—ã">–°–∏–≥–∞—Ä–µ—Ç—ã</option>
            <option value="–ê–ª–∫–æ–≥–æ–ª—å">–ê–ª–∫–æ–≥–æ–ª—å</option>
            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
          </select>
        </label>
        <label>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (—Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥–∞):
          <input type="text" name="subcategory" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ö–ª–µ–±" />
        </label>
        <label>–°—É–º–º–∞:
          <input type="number" name="amount" step="1" required />
        </label>
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </form>
      </div>

      <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ –≤—Å–µ–º–∏ –∑–∞–ø–∏—Å—è–º–∏ -->
      <table id="expensesTable">
        <thead>
          <tr>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–°—É–º–º–∞</th>
            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td colspan="2"><b>–ò—Ç–æ–≥–æ</b></td>
            <td class="total" id="totalCell">0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>

      <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º—ã) -->
      <h2>–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</h2>
      <table id="categorySummary">
        <thead>
          <tr>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–°—É–º–º–∞</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <td><b>–û–±—â–∏–π –∏—Ç–æ–≥</b></td>
            <td class="total" id="summaryTotal">0</td>
          </tr>
        </tfoot>
      </table>

      <!-- –ë–ª–æ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤ -->
      <div class="controls">
        <label>–ü–æ–¥–ø–∏—Å—å –¥–ª—è –æ—Ç—á—ë—Ç–∞:
          <input type="text" id="reportLabel" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞–π 2025">
        </label>
        <button id="saveReportBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—á—ë—Ç</button>
        <a href="year.html">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ç—á—ë—Ç–∞–º</a>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer__content">
        <a class="header__logo-link" href="advice.html">
          <img class="footer__logo" src="images/logo.png" height="36" width="170" alt="–õ–æ–≥–æ—Ç–∏–ø –°–µ–º–µ–π–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞">
        </a>
        <ul class="footer__contacts-list">
          <li class="footer__contacts-item">
            <span class="footer__contacts-text">–ü–æ–∑–≤–æ–Ω–∏—Ç—å –†–∏–Ω–∞—Ç—É</span>
            <a class="footer__contacts-phone" href="tel:+77056600636">+7 705 660 06 36</a>
          </li>
          <li class="footer__contacts-item">
            <span class="footer__contacts-text">–ü–æ–∑–≤–Ω–∏—Ç—å –ê–Ω–µ</span>
            <a class="footer__contacts-phone" href="tel:+77006937462">+7 700 693 74 62</a>
          </li>
        </ul>
        <div class="footer__info">
          <span class="footer__info-text">–°–µ–º–µ–π–Ω—ã–π –±—é–¥–∂–µ—Ç –•–∞—Å–∞–Ω–æ–≤—ã—Ö</span>
        </div>
        <span class="footer__note">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç 20.08.2025</span>
      </div>
    </div>
  </footer>

  <script>
    function safeNumber(v) {
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : 0;
    }

    function loadExpenses() {
      const data = JSON.parse(localStorage.getItem('expenses') || '[]');

      // === –ø–µ—Ä–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã) ===
      const tbody = document.querySelector('#expensesTable tbody');
      tbody.innerHTML = '';
      let total = 0;

      data.forEach((row, index) => {
        const amount = safeNumber(row.amount);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.category}</td>
          <td>${row.subcategory || ''}</td>
          <td>${amount.toFixed(2)}</td>
          <td><button class="delete-btn" data-index="${index}">–£–¥–∞–ª–∏—Ç—å</button></td>
        `;
        tbody.appendChild(tr);
        total += amount;
      });

      document.getElementById('totalCell').textContent = total.toFixed(2);

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const i = Number(e.currentTarget.dataset.index);
          const arr = JSON.parse(localStorage.getItem('expenses') || '[]');
          arr.splice(i, 1);
          localStorage.setItem('expenses', JSON.stringify(arr));
          loadExpenses();
        });
      });

      // === –≤—Ç–æ—Ä–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Å—É–º–º—ã) ===
         const summary = {};
      data.forEach(row => {
        const cat = row.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
        summary[cat] = (summary[cat] || 0) + safeNumber(row.amount);
      });

      const sorted = Object.entries(summary).sort((a, b) => b[1] - a[1]);

      const tbodySummary = document.querySelector('#categorySummary tbody');
      tbodySummary.innerHTML = '';
      let summaryTotal = 0;

      sorted.forEach(([cat, sum]) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${cat}</td><td>${sum.toFixed(2)}</td>`;
        tbodySummary.appendChild(tr);
        summaryTotal += sum;
      });

      document.getElementById('summaryTotal').textContent = summaryTotal.toFixed(2);
    }

    document.getElementById('expenseForm').addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const record = {
        category: formData.get('category'),
        subcategory: formData.get('subcategory') || '',
        amount: formData.get('amount')
      };

      const data = JSON.parse(localStorage.getItem('expenses') || '[]');
      data.push(record);
      localStorage.setItem('expenses', JSON.stringify(data));

      e.target.reset();
      loadExpenses();
    });

    // === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ ===
    document.getElementById('saveReportBtn').addEventListener('click', () => {
      const label = document.getElementById('reportLabel').value.trim();
      if (!label) {
        alert('–í–≤–µ–¥–∏—Ç–µ –ø–æ–¥–ø–∏—Å—å –¥–ª—è –æ—Ç—á—ë—Ç–∞!');
        return;
      }

      const tableHTML = document.getElementById('categorySummary').outerHTML;

      const reports = JSON.parse(localStorage.getItem('expenseReports') || '[]');
      reports.push({
        label: label,
        table: tableHTML,
        date: new Date().toISOString()
      });
      localStorage.setItem('expenseReports', JSON.stringify(reports));

      alert('–û—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! –¢–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–æ–π—Ç–µ year.html.');
      document.getElementById('reportLabel').value = '';
    });

    loadExpenses();

     // üì± –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
      .catch(err => console.log('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err));
  }
  </script>
</body>

</html>

